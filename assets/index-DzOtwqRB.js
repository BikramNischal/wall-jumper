var U=Object.defineProperty;var Z=(t,i,e)=>i in t?U(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var s=(t,i,e)=>Z(t,typeof i!="symbol"?i+"":i,e);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();const $=document.querySelector(".game-window"),w=document.querySelector(".canvas"),l=w.getContext("2d"),H=$.getBoundingClientRect();w.height=H.height;w.width=H.width;const f=2,K=f+1,d={width:w.width,height:w.height},u={x:0,y:-64,width:64,height:d.height+100,xOffSet:5},p={width:10,heightSmall:72,heightBig:160,gapX:150,gapY:150},M=8,k=-6,Q={width:24,height:24},W={width:32,height:32},L={width:24,height:24},N=100,tt=0+u.width,it=d.height/2;class y{constructor(i){s(this,"sound");this.sound=new Audio,this.sound.src=i}play(){this.sound.play()}stop(){this.sound.pause()}}class J{constructor(i,e){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"pointValue");s(this,"img");s(this,"loaded");s(this,"collisionSound");this.x=i,this.y=e,this.dx=10,this.dy=10,this.w=64,this.h=64,this.pointValue=1,this.loaded=!1,this.img=new Image,this.collisionSound=new y("./sounds/obstaclecollision.m4a")}moveInY(){this.y+=f}}class et extends J{constructor(e,n,r,o,a,g){super(e,n);s(this,"startPos");s(this,"endPos");s(this,"direction");this.startPos=a,this.endPos=g,this.direction=r,this.img.src=o,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.y)}oscillate(){this.direction==="horizontal"?(this.x>=this.endPos?this.dx=-Math.abs(this.dx):this.x<=this.startPos&&(this.dx=Math.abs(this.dx)),this.x+=this.dx):(this.y>=this.endPos?this.dy=-Math.abs(this.dy):this.y<=this.startPos&&(this.dy=Math.abs(this.dy)),this.y+=this.dy)}}class st extends et{constructor(e,n,r,o,a,g){super(e,n,r,o,a,g);s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.spriteHeight=166,this.spriteWidth=164.5,this.currentFrame=0,this.totalFrame=5,this.h=W.height,this.w=W.width,this.dx=1,this.pointValue=2}draw(){this.loaded&&l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),this.currentFrame=(this.currentFrame+1)%this.totalFrame}}function m(t){return Math.floor(Math.random()*t)}function O(t,i){return Math.floor(Math.random()*(i-t)+t)}function nt(){const t=m(100);return t<20&&t%2===0}function S(){const t=m(100);return t<100/2&&t%2===0}function v(){return m(100)<50}class I{constructor(i,e,n,r){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"type");s(this,"loaded");s(this,"spike");s(this,"effect");s(this,"effectUsed");s(this,"pointValue");s(this,"sound");this.x=i,this.y=e,this.dx=0,this.dy=f,this.w=p.width,this.h=p.heightSmall,this.pointValue=1,this.type=n,this.loaded=!1,this.spike=this.placeSpike(),this.img=new Image,this.img.src=r,this.img.onload=()=>{this.loaded=!0,this.draw()},this.effect=null,this.effectUsed=!1,this.sound=null}updateImage(i){this.img.src=i}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}setMainWall(){this.w=u.width,this.h=u.height}moveInY(){this.y+=f,this.spike&&(this.spike.y+=f)}moveInX(){this.x+=this.dx}placeSpike(){if(S()&&this.type<2){const e=ct();e.face==="left"?e.x=this.x-e.w:e.x=this.x+this.w;let n=this.y+m(this.h-e.h);return e.y=n,e}else return null}}function V(){switch(m(2)){case 0:return p.heightSmall;case 1:return p.heightBig;default:return p.heightSmall}}function rt(){return nt()?3:S()?2:1}function A(){const t=m(d.width/2),e=d.width*2/5+t+p.gapX;return e>d.width*.075?e-d.width/2:e}function ot(){const t=.5*d.width,i=3/4*d.width;return O(t,i)}class q{constructor(i,e,n,r,o,a){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");s(this,"pointValue");s(this,"collisionSound");this.x=i,this.y=e,this.dx=-2,this.dy=f,this.w=L.width,this.h=L.height,this.pointValue=3,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0},this.spriteHeight=o,this.spriteWidth=r,this.totalFrame=a,this.currentFrame=0,this.w=64,this.h=64,this.collisionSound=new y("./sounds/obstaclecollision.m4a")}draw(i){this.loaded&&l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),i%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}drawVertical(i){this.loaded&&l.drawImage(this.img,0,this.currentFrame*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),i%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}moveInY(){this.y+=this.dy}changeDirection(){this.x<=u.x+u.width||this.x+this.w>=d.width?(this.dx*=-1,this.dx<0?this.img.src="./images/demon-left.png":this.img.src="./images/demon-right.png"):this.dx=this.dx}moveInX(){this.changeDirection(),this.x+=this.dx}}class R extends J{constructor(e,n,r){super(e,n);s(this,"face");this.face=r,this.w=24,this.h=24,this.selectSpike()}selectSpike(){const e=v();this.face==="right"?e?this.img.src="./images/spike1-right.png":this.img.src="./images/spike2-right.png":e?this.img.src="./images/spike1-left.png":this.img.src="./images/spike2-left.png",this.img.onload=()=>{this.loaded=!0}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}moveInY(){this.y+=f}}function C(t){let i;const e=ot(),n=V(),r=t?t.y-n-p.gapY:d.height-n-p.gapY,o=rt();return o===1?i=new I(e,r,1,"./images/normal-wall.png"):o===2?i=new I(e,r,2,"./images/rubber-wall.png"):i=new I(e,r,3,"./images/ice-wall.png"),i.h=n,i}function ht(t){const i=[];for(let e=0;e<t;++e){let n=i.length?C(i[i.length-1]):C(null);i.push(n)}return i}function dt(){const t=A(),i=t+N-2*W.width>d.width-W.width?d.width-W.width:t+N,e=O(t,i);return new st(e,0,"horizontal","./images/saw-blade.png",t,i)}function z(t){const i=d.height/(t+1),e=[];for(let n=0;n<t;++n){const r=dt(),o=d.height-r.h-i*(n+1);r.y=o,r.dx=v()?1:-1,r.dy=v()?1:-1,e.push(r)}return e}function at(t){return new R(0,0,t)}function ct(){const t=v()?"right":"left";return at(t)}function X(){const t=Q.height*10,i=m(4),e=[];for(let n=0;n<i;++n){let r=0;e.length&&(r=e[e.length-1].y-t);const o=new R(u.width,r,"right");o.w=32,o.h=32,o.x=o.x-u.xOffSet,e.push(o)}return e}function lt(){const t=A();return new q(t,0,"./images/demon-left.png",79,69,4)}function ut(){return[]}function pt(){let t="";switch(m(4)){case 0:t="./images/spider-black.png";break;case 1:t="./images/spider-purple.png";break;case 2:t="./images/spider-green.png";break;case 3:t="./images/spider-brown.png";break}const e=u.x+u.width-u.xOffSet*2,n=new q(e,0,t,49,80.3,3);return n.dy=K,n}function ft(){return[]}function mt(t){l.fillStyle="white",l.font="50px Offside",l.fillText(`${t}`,d.width/2,50)}function gt(t,i){if(t.length){const e=t[t.length-1];if(e.y>d.height&&(i.score+=t[0].pointValue,t.shift()),t[t.length-1].y>p.gapY){const n=V(),r=t[t.length-1].y-p.gapY-n,o=C(e);o.h=n,o.y=r,t.push(o)}}else t.push(C(null))}function yt(t,i){if(t.forEach(e=>{e.y>d.height&&(i.score+=e.pointValue,t.shift())}),t.length===0){const e=z(m(3));e.reverse(),e.forEach(n=>{n.y*=-1}),t.push(...e)}}function wt(t,i){if(t.forEach(e=>{e.y>d.height&&(i.score+=e.pointValue,t.shift())}),t.length===0){const e=X();t.push(...e)}}function D(t,i,e){t.length&&(t[0].y>d.height&&(e.score+=t[0].pointValue,t.shift()),t.forEach(n=>{n.moveInY(),i==="demon"&&n.moveInX()}))}function xt(){let t;const i=localStorage.getItem("walljumper");return i?t=JSON.parse(i):t=[],t}function kt(t){localStorage.setItem("walljumper",JSON.stringify(t))}function bt(t,i){let e=!1;i.forEach(n=>{n.name===t.name&&(n.value<t.value&&(n.value=t.value),e=!0)}),e||i.push(t)}const Wt=document.querySelector(".start-menu"),G=document.querySelector(".restart-menu"),It=document.querySelector(".score"),j=document.querySelector(".leaderboard");function Et(t){j.innerHTML="";for(const i of t){const e=document.createElement("p"),n=document.createElement("span"),r=document.createElement("span");e.classList.add("leaderboard-row"),n.classList.add("leaderboard-entry"),r.classList.add("leaderboard-entry"),n.innerHTML=i.name,r.innerHTML=i.value.toString(),e.appendChild(n),e.appendChild(r),j.appendChild(e)}}function T(t){Wt.style.display="none",G.style.display="none",w.style.display="block";const i=setTimeout(()=>{t.clickState=!0,clearTimeout(i)},10)}function x(t,i){const e=xt(),n={name:i.userName,value:i.score};bt(n,e),e.sort((o,a)=>a.value-o.value),kt(e),Et(e),G.style.display="flex",It.innerHTML=`${i.userName} : ${i.score}`,w.style.display="none";const r=setTimeout(()=>{t.clickState=!0,clearTimeout(r)},10)}class Y{constructor(i,e,n){s(this,"x");s(this,"y");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"duration");this.x=i,this.y=e,this.w=32,this.h=48,this.dy=f,this.loaded=!1,this.img=new Image,this.img.src=n,this.duration=0,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}setDuration(i){this.duration=i}getDuration(){return this.duration}moveInY(){this.y+=this.dy}}function St(t,i){const e=t.x+t.w/2-(i.x+i.w/2),n=t.y+t.h/2-(i.y+i.h/2),r=(t.w+i.w)/2,o=(t.h+i.h)/2,a=r*n,g=o*e;if(Math.abs(e)<=r&&Math.abs(n)<=o)if(a>g){if(a>-g)t.y=i.y+i.h-t.h/2,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w;else if(t.x=i.x-t.w,t.xDirection=-1,t.img.src="./images/grab-right.png",i.type===3&&!i.effectUsed){const F=new Y(t.x,t.y,"./images/icecloud-right.png");i.effect=F}}else if(a>-g){if(t.x=i.x+i.w,t.xDirection=1,t.img.src="./images/grab-left.png",i.type===3&&!i.effectUsed){const F=new Y(t.x,t.y,"./images/icecloud-left.png");i.effect=F}}else t.y=i.y,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w}function B(t){t.xDirection*=-1,t.dx=t.xDirection*M,t.dy+=k/2,t.isJumping=!0}class vt{constructor(i,e,n){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"horizontalDelay");s(this,"gravity");s(this,"isJumping");s(this,"jumpCount");s(this,"xDirection");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");s(this,"jumpSound");s(this,"airJumpSound");s(this,"fallSound");this.x=i,this.y=e,this.w=32,this.h=32,this.xDirection=1,this.horizontalDelay=.05,this.gravity=.1,this.dx=M,this.dy=k,this.isJumping=!1,this.jumpCount=2,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0,this.draw()},this.spriteHeight=67,this.spriteWidth=64,this.currentFrame=0,this.totalFrame=8,this.jumpSound=new y("./sounds/jumpsound.m4a"),this.airJumpSound=new y("./sounds/airjumpsound.m4a"),this.fallSound=new y("./sounds/fallsound.m4a")}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}drawJumpSprite(i){this.loaded&&(l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,48,48),i%2===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame))}resetJump(){this.jumpCount===1&&(this.xDirection*=-1),this.dx=M*this.xDirection,this.dy=k}changeJumpingImage(){this.dx>0&&this.jumpCount===1?this.img.src="./images/jump-right.png":this.dx<0&&this.jumpCount===1?this.img.src="./images/jump-left.png":this.dx>0&&this.jumpCount===0?this.img.src="./images/mid-jump-right-sprite.png":this.img.src="./images/mid-jump-left-sprite.png"}jump(){this.changeJumpingImage(),this.dy+=this.gravity,this.dx=this.dx>0?this.dx-this.horizontalDelay:this.dx+this.horizontalDelay,this.x+=this.dx,this.dy>0?this.y+=this.dy:this.y>0?this.y+=this.dy:this.y=0,this.dy>-k&&(this.dy=-k)}isColliding(i){return i.x<this.x+this.w&&i.x+i.w>this.x&&i.y<this.y+this.h/2&&i.y+i.h>this.y}collisionWall(i){this.isColliding(i)&&(this.jumpCount=2,this.isJumping=!1,i.type===2?(i.sound=new y("./sounds/rubberbounce1.mp3"),i.sound.play(),this.isJumping=!0,--this.jumpCount,B(this)):i.type===3&&(i.sound=new y("./sounds/freezingSound.m4a"),i.sound.play())),St(this,i)}moveInY(){this.y+=f,this.x+this.w>d.width&&B(this)}}const Ct=document.querySelector(".btn--start"),Ft=document.querySelector(".btn--restart"),P=document.querySelector(".user-name");let b;P.onchange=()=>{b=P.value};const h={pause:!1,clickState:!1,restart:!1},_=()=>({blades:z(2),mainWall:new I(u.x,u.y,0,"./images/main-platform.png"),walls:ht(3),player:new vt(tt,it,"./images/grab-left.png"),gameSpeed:0,demons:ut(),spiders:ft(),mainWallSpikes:X(),score:0,userName:"Unknown"});let c=_();function E(t){l.clearRect(0,0,d.width,d.height),mt(t.score),++t.gameSpeed,t.mainWall.draw(),t.gameSpeed%500===0&&S()&&t.demons.push(lt()),D(t.demons,"demon",t);for(let i=0;i<t.demons.length&&!h.restart;++i){const e=t.demons[i];if(e.draw(t.gameSpeed),t.player.isColliding(e)){h.restart=!0,e.collisionSound.play(),x(h,t);return}}t.gameSpeed%300===0&&S()&&t.spiders.push(pt()),D(t.spiders,"spider",t);for(let i=0;i<t.spiders.length&&!h.restart;++i){const e=t.spiders[i];if(e.drawVertical(t.gameSpeed),t.player.isColliding(e)){h.restart=!0,e.collisionSound.play(),x(h,t);return}}for(let i=0;i<t.mainWallSpikes.length&&!h.restart;++i){const e=t.mainWallSpikes[i];if(e.moveInY(),e.draw(),t.player.isColliding(e)){h.restart=!0,e.collisionSound.play(),x(h,t);return}}if(t.player.moveInY(),t.player.y>d.height){h.restart=!0,t.player.fallSound.play(),x(h,t);return}t.player.collisionWall(t.mainWall),t.player.jumpCount?t.player.draw():t.player.drawJumpSprite(t.gameSpeed),t.player.isJumping&&t.player.jump();for(let i=0;i<t.walls.length&&!h.restart;++i){const e=t.walls[i];if(e.moveInY(),e.draw(),e.effect&&!e.effectUsed){e.effect.draw(),h.clickState=!1;const n=setTimeout(()=>{e.effect=null,e.effectUsed=!0,h.clickState=!0,clearTimeout(n)},2e3)}if(e.spike&&(e.spike.draw(),t.player.isColliding(e.spike))){h.restart=!0,e.spike.collisionSound.play(),x(h,t);return}t.player.collisionWall(e)}for(let i=0;i<t.blades.length;++i){const e=t.blades[i];if(e.moveInY(),e.draw(),e.oscillate(),t.player.isColliding(e)){h.restart=!0,e.collisionSound.play(),x(h,t);return}}yt(t.blades,t),gt(t.walls,t),wt(t.mainWallSpikes,t),!h.pause&&requestAnimationFrame(()=>E(t))}function Mt(){Ct.onclick=()=>{b&&(c.userName=b),h.clickState=!1,T(h),c.mainWall.setMainWall(),E(c)},Ft.onclick=()=>{h.clickState=!1,h.restart=!1,T(h),c=_(),b&&(c.userName=b),c.mainWall.setMainWall(),E(c)},document.addEventListener("click",()=>{!h.pause&&h.clickState&&(l.clearRect(0,0,d.width,d.height),c.player.jumpCount>0&&(c.player.isJumping=!0,c.player.jumpCount===2?c.player.jumpSound.play():c.player.airJumpSound.play(),c.player.resetJump(),--c.player.jumpCount))}),document.addEventListener("keydown",t=>{t.key===" "&&h.pause?(h.pause=!1,E(c)):t.key===" "&&(h.pause=!0)})}Mt();
