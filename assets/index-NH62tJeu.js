var O=Object.defineProperty;var J=(t,i,e)=>i in t?O(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var s=(t,i,e)=>J(t,typeof i!="symbol"?i+"":i,e);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))h(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&h(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function h(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const T=document.querySelector(".game-window"),f=document.querySelector(".canvas"),g=f.getContext("2d"),Y=T.getBoundingClientRect();f.height=Y.height;f.width=Y.width;const l=1,X=l+1,a={width:f.width,height:f.height},c={x:0,y:-64,width:64,height:a.height+100,xOffSet:5},m={width:10,heightSmall:72,heightBig:160,gapX:150,gapY:150},E=8,y=-6,R={width:24,height:24},x={width:32,height:32},M={width:24,height:24},v=100,_=0+c.width,q=a.height/2;class D{constructor(i,e){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");this.x=i,this.y=e,this.dx=10,this.dy=10,this.w=64,this.h=64,this.loaded=!1,this.img=new Image}moveInY(){this.y+=l}}class G extends D{constructor(e,h,n,r,d,p){super(e,h);s(this,"startPos");s(this,"endPos");s(this,"direction");this.startPos=d,this.endPos=p,this.direction=n,this.img.src=r,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.y)}oscillate(){this.direction==="horizontal"?(this.x>=this.endPos?this.dx=-Math.abs(this.dx):this.x<=this.startPos&&(this.dx=Math.abs(this.dx)),this.x+=this.dx):(this.y>=this.endPos?this.dy=-Math.abs(this.dy):this.y<=this.startPos&&(this.dy=Math.abs(this.dy)),this.y+=this.dy)}}class z extends G{constructor(e,h,n,r,d,p){super(e,h,n,r,d,p);s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.spriteHeight=166,this.spriteWidth=164.5,this.currentFrame=0,this.totalFrame=5,this.h=x.height,this.w=x.width,this.dx=1}draw(){this.loaded&&g.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),this.currentFrame=(this.currentFrame+1)%this.totalFrame}}function u(t){return Math.floor(Math.random()*t)}function P(t,i){return Math.floor(Math.random()*(i-t)+t)}function S(){const t=u(100);return t<100/2&&t%2===0}function k(){return u(100)<50}class F{constructor(i,e,h,n){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"type");s(this,"loaded");s(this,"spike");this.x=i,this.y=e,this.dx=0,this.dy=l,this.w=m.width,this.h=m.heightSmall,this.type=h,this.loaded=!1,this.spike=this.placeSpike(),this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0,this.draw()}}updateImage(i){this.img.src=i}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.h)}setMainWall(){this.w=c.width,this.h=c.height}moveInY(){this.y+=l,this.spike&&(this.spike.y+=l)}moveInX(){this.x+=this.dx}placeSpike(){if(S()&&this.type<2){const e=it();e.face==="left"?e.x=this.x-e.w:e.x=this.x+this.w;let h=this.y+u(this.h-e.h);return e.y=h,e}else return null}}function L(){switch(u(2)){case 0:return m.heightSmall;case 1:return m.heightBig;default:return m.heightSmall}}function V(){return S()?2:1}function H(){const t=u(a.width/2),e=a.width*2/5+t+m.gapX;return e>a.width*.075?e-a.width/2:e}function Z(){const t=.5*a.width,i=3/4*a.width;return P(t,i)}class j{constructor(i,e,h,n,r,d){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.x=i,this.y=e,this.dx=-2,this.dy=l,this.w=M.width,this.h=M.height,this.loaded=!1,this.img=new Image,this.img.src=h,this.img.onload=()=>{this.loaded=!0},this.spriteHeight=r,this.spriteWidth=n,this.totalFrame=d,this.currentFrame=0,this.w=64,this.h=64}draw(i){this.loaded&&g.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),i%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}drawVertical(i){this.loaded&&g.drawImage(this.img,0,this.currentFrame*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),i%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}moveInY(){this.y+=this.dy}changeDirection(){this.x<=c.x+c.width||this.x+this.w>=a.width?(this.dx*=-1,this.dx<0?this.img.src="./images/demon-left.png":this.img.src="./images/demon-right.png"):this.dx=this.dx}moveInX(){this.changeDirection(),this.x+=this.dx}}class A extends D{constructor(e,h,n){super(e,h);s(this,"face");this.face=n,this.w=24,this.h=24,this.selectSpike()}selectSpike(){const e=k();this.face==="right"?e?this.img.src="./images/spike1-right.png":this.img.src="./images/spike2-right.png":e?this.img.src="./images/spike1-left.png":this.img.src="./images/spike2-left.png",this.img.onload=()=>{this.loaded=!0}}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.h)}moveInY(){this.y+=l}}function W(t){const i=Z(),e=L(),h=t?t.y-e-m.gapY:a.height-e-m.gapY,n=V();let r;return n===1?r=new F(i,h,1,"./images/normal-wall.png"):r=new F(i,h,2,"./images/rubber-wall.png"),r.h=e,r}function K(t){const i=[];for(let e=0;e<t;++e){let h=i.length?W(i[i.length-1]):W(null);i.push(h)}return i}function Q(){const t=H(),i=t+v-2*x.width>a.width-x.width?a.width-x.width:t+v,e=P(t,i);return new z(e,0,"horizontal","./images/saw-blade.png",t,i)}function B(t){const i=a.height/(t+1),e=[];for(let h=0;h<t;++h){const n=Q(),r=a.height-n.h-i*(h+1);n.y=r,n.dx=k()?1:-1,n.dy=k()?1:-1,e.push(n)}return e}function U(t){if(t.length){const i=t[t.length-1];if(t[t.length-1].y>m.gapY){const e=L(),h=t[t.length-1].y-m.gapY-e,n=W(i);n.h=e,n.y=h,t.push(n)}}else t.push(W(null))}function $(t){if(t.forEach(i=>{i.y>a.height&&t.shift()}),t.length===0){const i=B(u(3));i.reverse(),i.forEach(e=>{e.y*=-1}),t.push(...i)}}function tt(t){return new A(0,0,t)}function it(){const t=k()?"right":"left";return tt(t)}function N(){const t=R.height*10,i=u(4),e=[];for(let h=0;h<i;++h){let n=0;e.length&&(n=e[e.length-1].y-t);const r=new A(c.width,n,"right");r.w=32,r.h=32,r.x=r.x-c.xOffSet,e.push(r)}return e}function et(t){if(t.forEach(i=>{i.y>a.height&&t.shift()}),t.length===0){const i=N();t.push(...i)}}function st(){const t=H();return new j(t,0,"./images/demon-left.png",79,69,4)}function ht(){return[]}function nt(){let t="";switch(u(4)){case 0:t="./images/spider-black.png";break;case 1:t="./images/spider-purple.png";break;case 2:t="./images/spider-green.png";break;case 3:t="./images/spider-brown.png";break}const e=c.x+c.width-c.xOffSet*2,h=new j(e,0,t,49,80.3,3);return h.dy=X,h}function rt(){return[]}function C(t,i,e){t.length&&(t[0].y>a.height&&t.shift(),t.forEach(h=>{h.moveInY(),e==="demon"?(h.draw(i),h.moveInX()):h.drawVertical(i)}))}function ot(t,i){const e=t.x+t.w/2-(i.x+i.w/2),h=t.y+t.h/2-(i.y+i.h/2),n=(t.w+i.w)/2,r=(t.h+i.h)/2,d=n*h,p=r*e;Math.abs(e)<=n&&Math.abs(h)<=r&&(d>p?d>-p?(t.y=i.y+i.h-t.h/2,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w):(t.x=i.x-t.w,t.xDirection=-1,t.img.src="./images/grab-right.png"):d>-p?(t.x=i.x+i.w,t.xDirection=1,t.img.src="./images/grab-left.png"):(t.y=i.y,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w))}function at(t){t.xDirection*=-1,t.dx=t.xDirection*E,t.dy+=t.gravity,t.isJumping=!0}class dt{constructor(i,e,h){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"horizontalDelay");s(this,"gravity");s(this,"isJumping");s(this,"jumpCount");s(this,"xDirection");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.x=i,this.y=e,this.w=32,this.h=32,this.xDirection=1,this.horizontalDelay=.05,this.gravity=.1,this.dx=E,this.dy=y,this.isJumping=!1,this.jumpCount=2,this.loaded=!1,this.img=new Image,this.img.src=h,this.img.onload=()=>{this.loaded=!0,this.draw()},this.spriteHeight=67,this.spriteWidth=64,this.currentFrame=0,this.totalFrame=8}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.h)}drawJumpSprite(i){this.loaded&&(g.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,48,48),i%2===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame))}resetJump(){this.jumpCount===1&&(this.xDirection*=-1),this.dx=E*this.xDirection,this.dy=y}changeJumpingImage(){this.dx>0&&this.jumpCount===1?this.img.src="./images/jump-right.png":this.dx<0&&this.jumpCount===1?this.img.src="./images/jump-left.png":this.dx>0&&this.jumpCount===0?this.img.src="./images/mid-jump-right-sprite.png":this.img.src="./images/mid-jump-left-sprite.png"}jump(){this.changeJumpingImage(),this.dy+=this.gravity,this.dx=this.dx>0?this.dx-this.horizontalDelay:this.dx+this.horizontalDelay,this.x+=this.dx,this.dy>0?this.y+=this.dy:this.y>0?this.y+=this.dy:this.y=0,this.dy>-y&&(this.dy=-y)}isColliding(i){return i.x<this.x+this.w&&i.x+i.w>this.x&&i.y<this.y+this.h/2&&i.y+i.h>this.y}collisionWall(i){this.isColliding(i)&&(this.jumpCount=2,this.isJumping=!1,i.type===2&&(this.isJumping=!0,--this.jumpCount,at(this))),ot(this,i)}moveInY(){this.y+=l}}const ct=document.querySelector(".btn--start"),mt=document.querySelector(".btn--restart"),gt=document.querySelector(".start-menu"),lt=document.querySelector(".restart-menu");let I=!0;const b={pause:!1,start:!1},o={blades:B(2),mainWall:new F(c.x,c.y,0,"./images/main-platform.png"),walls:K(4),player:new dt(_,q,"./images/grab-left.png"),gameSpeed:0,demons:ht(),spiders:rt(),mainWallSpikes:N()};o.mainWall.setMainWall();function w(){g.clearRect(0,0,a.width,a.height),++o.gameSpeed,o.gameSpeed%500===0&&S()&&o.demons.push(st()),C(o.demons,o.gameSpeed,"demon"),o.player.moveInY(),o.mainWall.draw(),o.gameSpeed%300===0&&S()&&o.spiders.push(nt()),C(o.spiders,o.gameSpeed,"spider"),o.mainWallSpikes.forEach(t=>{t.moveInY(),t.draw()}),o.player.collisionWall(o.mainWall),o.player.jumpCount?o.player.draw():o.player.drawJumpSprite(o.gameSpeed),o.player.isJumping&&o.player.jump(),o.walls.forEach(t=>{t.moveInY(),t.draw(),t.spike&&(t.spike.draw(),o.player.isColliding(t.spike)&&console.log("collision with spike")),o.player.collisionWall(t)}),o.blades.forEach(t=>{t.moveInY(),t.draw(),t.oscillate()}),$(o.blades),U(o.walls),et(o.mainWallSpikes),requestAnimationFrame(w)}function ut(){ct.onclick=()=>{gt.style.display="none",f.style.display="block",setTimeout(()=>{b.start=!0},100),w()},mt.onclick=()=>{lt.style.display="none",f.style.display="block",setTimeout(()=>{b.start=!0}),w()},document.addEventListener("click",()=>{b.start&&(g.clearRect(0,0,a.width,a.height),o.player.jumpCount>0&&(o.player.isJumping=!0,o.player.resetJump(),--o.player.jumpCount))}),document.addEventListener("keydown",t=>{t.key===" "&&I?(I=!1,w()):t.key===" "&&(I=!0)})}ut();
