var F=Object.defineProperty;var v=(t,i,s)=>i in t?F(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s;var e=(t,i,s)=>v(t,typeof i!="symbol"?i+"":i,s);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))h(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&h(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const T=document.querySelector(".game-window"),p=document.querySelector(".canvas"),g=p.getContext("2d"),L=T.getBoundingClientRect();p.height=L.height;p.width=L.width;const f=2,m=p.width,u=p.height,A=64,j=u+100,J=0,N=-64,Y=10,C=72,k=160,G=150,y=150,W=12,x=-12,O=50,B=0+A,R=u/2;class M{constructor(i,s){e(this,"x");e(this,"y");e(this,"dx");e(this,"dy");e(this,"w");e(this,"h");e(this,"img");e(this,"loaded");this.x=i,this.y=s,this.dx=10,this.dy=10,this.w=64,this.h=64,this.loaded=!1,this.img=new Image}moveInY(){this.y+=f}}class X extends M{constructor(s,h,n,o,a,r){super(s,h);e(this,"startPos");e(this,"endPos");e(this,"direction");this.startPos=a,this.endPos=r,this.direction=n,this.img.src=o,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.y)}oscillate(){this.direction==="horizontal"?(this.x>=this.endPos?this.dx=-Math.abs(this.dx):this.x<=this.startPos&&(this.dx=Math.abs(this.dx)),this.x+=this.dx):(this.y>=this.endPos?this.dy=-Math.abs(this.dy):this.y<=this.startPos&&(this.dy=Math.abs(this.dy)),this.y+=this.dy)}}class z extends X{constructor(s,h,n,o,a,r){super(s,h,n,o,a,r);e(this,"spriteWidth");e(this,"spriteHeight");e(this,"currentFrame");e(this,"totalFrame");this.spriteHeight=166,this.spriteWidth=164.5,this.currentFrame=0,this.totalFrame=5,this.h=32,this.w=32,this.dx=1}draw(){this.loaded&&g.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),this.currentFrame=(this.currentFrame+1)%this.totalFrame}}function l(t){return Math.floor(Math.random()*t)}function q(t,i){return Math.floor(Math.random()*(i-t)+t)}function H(){const t=l(100);return t>100/2&&t%2===0}function I(){return l(100)<50}class V extends M{constructor(s,h,n){super(s,h);e(this,"face");this.face=n,this.w=32,this.h=32,this.selectSpike()}selectSpike(){const s=l(4);if(this.face==="right")switch(s){case 1:this.img.src="./images/spike1-right.png";break;case 2:this.img.src="./images/spike2-right.png";break;case 3:this.img.src="./images/spike3-right.png";break;default:this.img.src="./images/spike2-right.png";break}else switch(s){case 1:this.img.src="./images/spike1-left.png";break;case 2:this.img.src="./images/spike2-left.png";break;case 3:this.img.src="./images/spike3-left.png";break;default:this.img.src="./images/spike2-left.png";break}this.img.onload=()=>{this.loaded=!0}}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.h)}drawSpike(s){this.img.src=s,this.img.onload=()=>{this.loaded=!0,this.draw()}}}function K(){const t=I()?"right":"left";return new V(200,200,t)}class w{constructor(i,s,h,n){e(this,"x");e(this,"y");e(this,"dx");e(this,"dy");e(this,"w");e(this,"h");e(this,"img");e(this,"type");e(this,"loaded");e(this,"spike");this.x=i,this.y=s,this.dx=0,this.dy=f,this.w=Y,this.h=C,this.type=h,this.loaded=!1,this.spike=this.placeSpike(),this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0,this.draw()}}updateImage(i){this.img.src=i}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.h)}setMainWall(){this.w=A,this.h=j}moveInY(){this.y+=f,this.spike&&(this.spike.y+=f)}moveInX(){this.x+=this.dx}placeSpike(){if(H()&&this.type<2){const s=K();return s.face==="left"?s.x=this.x-s.w:s.x=this.x+this.w,s.y=this.y+this.h/2,s}else return null}}function _(){switch(l(2)){case 0:return C;case 1:return k;default:return k}}function U(){return H()?2:1}function $(){const t=l(m/2),s=m*2/5+t+G;return s>m*.075?s-m/2:s}function P(){const t=.5*m,i=3/4*m;return q(t,i)}function b(t){const i=P(),s=_(),h=t?t.y-s-y:u-s-y,n=U();let o;return n===1?o=new w(i,h,1,"./images/normal-wall.png"):o=new w(i,h,2,"./images/rubber-wall.png"),o.h=s,o}function Q(t){const i=[];for(let s=0;s<t;++s){let h=i.length?b(i[i.length-1]):b(null);i.push(h)}return i}function S(t){const i=u/(t+1),s=[];for(let h=0;h<t;++h){const n=$(),o=n+O,a=n+l(50),r=new z(a,0,"horizontal","./images/saw-blade.png",n,o),E=u-r.h-i*(h+1);r.y=E,r.dx=I()?1:-1,r.dy=I()?1:-1,r.y>0&&s.push(r)}return s}function Z(t){if(t[t.length-1].y>y){const i=_(),s=t[t.length-1].y-y-i,h=new w(P(),s,1,"./images/normal-wall.png");h.h=i,t.push(h)}}function tt(t){if(t.forEach(i=>{i.y>u&&t.shift()}),t.length===0){const i=S(l(5));i.reverse(),i.forEach(s=>{s.y*=-1}),t.push(...i)}}function it(t,i){const s=t.x+t.w/2-(i.x+i.w/2),h=t.y+t.h/2-(i.y+i.h/2),n=(t.w+i.w)/2,o=(t.h+i.h)/2,a=n*h,r=o*s;Math.abs(s)<=n&&Math.abs(h)<=o&&(a>r?a>-r?(t.y=i.y+i.h-t.h/2,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w):(t.x=i.x-t.w,t.xDirection=-1,t.img.src="./images/grab-right.png"):a>-r?(t.x=i.x+i.w,t.xDirection=1,t.img.src="./images/grab-left.png"):(t.y=i.y,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w))}function st(t){t.xDirection*=-1,t.dx=t.xDirection*W,t.dy-=t.gravity,t.isJumping=!0}class et{constructor(i,s,h){e(this,"x");e(this,"y");e(this,"dx");e(this,"dy");e(this,"w");e(this,"h");e(this,"img");e(this,"loaded");e(this,"horizontalDelay");e(this,"gravity");e(this,"isJumping");e(this,"jumpCount");e(this,"xDirection");e(this,"spriteWidth");e(this,"spriteHeight");e(this,"currentFrame");e(this,"totalFrame");this.x=i,this.y=s,this.w=32,this.h=32,this.xDirection=1,this.horizontalDelay=.1,this.gravity=.5,this.dx=W,this.dy=x,this.isJumping=!1,this.jumpCount=2,this.loaded=!1,this.img=new Image,this.img.src=h,this.img.onload=()=>{this.loaded=!0,this.draw()},this.spriteHeight=67,this.spriteWidth=64,this.currentFrame=0,this.totalFrame=8}draw(){this.loaded&&g.drawImage(this.img,this.x,this.y,this.w,this.h)}drawJumpSprite(){this.loaded&&(g.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,48,48),this.currentFrame=(this.currentFrame+1)%this.totalFrame)}resetJump(){this.jumpCount===1&&(this.xDirection*=-1),this.dx=W*this.xDirection,this.dy=x}changeJumpingImage(){this.dx>0&&this.jumpCount===1?this.img.src="./images/jump-right.png":this.dx<0&&this.jumpCount===1?this.img.src="./images/jump-left.png":this.dx>0&&this.jumpCount===0?this.img.src="./images/mid-jump-right-sprite.png":this.img.src="./images/mid-jump-left-sprite.png"}jump(){this.changeJumpingImage(),this.dy+=this.gravity,this.dx=this.dx>0?this.dx-this.horizontalDelay:this.dx+this.horizontalDelay,this.x+=this.dx,this.dy>0?this.y+=this.dy:this.y>0?this.y+=this.dy:this.y=0,this.dy>-x&&(this.dy=-x)}isColliding(i){return i.x<this.x+this.w&&i.x+i.w>this.x&&i.y<this.y+this.h/2&&i.y+i.h>this.y}collisionWall(i){this.isColliding(i)&&(this.jumpCount=2,this.isJumping=!1,i.type===2&&(this.isJumping=!0,--this.jumpCount,st(this))),it(this,i)}moveInY(){this.y+=f}}const nt=document.querySelector(".game-window"),c=new et(B,R,"./images/grab-left.png"),d={blades:S(2),mainWall:new w(J,N,0,"./images/main-platform.png"),walls:Q(4),player:c,airJump:!1};d.mainWall.setMainWall();function D(){g.clearRect(0,0,m,u),d.player.moveInY(),d.mainWall.draw(),c.collisionWall(d.mainWall),c.jumpCount?c.draw():c.drawJumpSprite(),c.isJumping&&c.jump(),tt(d.blades),Z(d.walls),d.walls.forEach(t=>{t.moveInY(),t.draw(),t.spike&&(t.spike.draw(),c.isColliding(t.spike)&&console.log("spike collision")),c.collisionWall(t)}),d.blades.forEach(t=>{t.moveInY(),t.draw(),t.oscillate()}),requestAnimationFrame(D)}nt.addEventListener("click",()=>{g.clearRect(0,0,m,u),c.jumpCount>0&&(c.isJumping=!0,c.resetJump(),--c.jumpCount)});D();
