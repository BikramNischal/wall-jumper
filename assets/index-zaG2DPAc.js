var G=Object.defineProperty;var _=(t,i,e)=>i in t?G(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var s=(t,i,e)=>_(t,typeof i!="symbol"?i+"":i,e);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))n(h);new MutationObserver(h=>{for(const r of h)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function e(h){const r={};return h.integrity&&(r.integrity=h.integrity),h.referrerPolicy&&(r.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?r.credentials="include":h.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(h){if(h.ep)return;h.ep=!0;const r=e(h);fetch(h.href,r)}})();const q=document.querySelector(".game-window"),y=document.querySelector(".canvas"),l=y.getContext("2d"),T=q.getBoundingClientRect();y.height=T.height;y.width=T.width;const m=2,U=m+1,a={width:y.width,height:y.height},c={x:0,y:-64,width:64,height:a.height+100,xOffSet:5},f={width:10,heightSmall:72,heightBig:160,gapX:150,gapY:150},M=8,w=-6,V={width:24,height:24},k={width:32,height:32},v={width:24,height:24},D=100,Z=0+c.width,K=a.height/2;class H{constructor(i,e){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");this.x=i,this.y=e,this.dx=10,this.dy=10,this.w=64,this.h=64,this.loaded=!1,this.img=new Image}moveInY(){this.y+=m}}class Q extends H{constructor(e,n,h,r,d,p){super(e,n);s(this,"startPos");s(this,"endPos");s(this,"direction");this.startPos=d,this.endPos=p,this.direction=h,this.img.src=r,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.y)}oscillate(){this.direction==="horizontal"?(this.x>=this.endPos?this.dx=-Math.abs(this.dx):this.x<=this.startPos&&(this.dx=Math.abs(this.dx)),this.x+=this.dx):(this.y>=this.endPos?this.dy=-Math.abs(this.dy):this.y<=this.startPos&&(this.dy=Math.abs(this.dy)),this.y+=this.dy)}}class $ extends Q{constructor(e,n,h,r,d,p){super(e,n,h,r,d,p);s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.spriteHeight=166,this.spriteWidth=164.5,this.currentFrame=0,this.totalFrame=5,this.h=k.height,this.w=k.width,this.dx=1}draw(){this.loaded&&l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),this.currentFrame=(this.currentFrame+1)%this.totalFrame}}function g(t){return Math.floor(Math.random()*t)}function j(t,i){return Math.floor(Math.random()*(i-t)+t)}function tt(){const t=g(100);return t<20&&t%2===0}function b(){const t=g(100);return t<100/2&&t%2===0}function E(){return g(100)<50}class W{constructor(i,e,n,h){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"type");s(this,"loaded");s(this,"spike");s(this,"effect");s(this,"effectUsed");this.x=i,this.y=e,this.dx=0,this.dy=m,this.w=f.width,this.h=f.heightSmall,this.type=n,this.loaded=!1,this.spike=this.placeSpike(),this.img=new Image,this.img.src=h,this.img.onload=()=>{this.loaded=!0,this.draw()},this.effect=null,this.effectUsed=!1}updateImage(i){this.img.src=i}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}setMainWall(){this.w=c.width,this.h=c.height}moveInY(){this.y+=m,this.spike&&(this.spike.y+=m)}moveInX(){this.x+=this.dx}placeSpike(){if(b()&&this.type<2){const e=rt();e.face==="left"?e.x=this.x-e.w:e.x=this.x+this.w;let n=this.y+g(this.h-e.h);return e.y=n,e}else return null}}function A(){switch(g(2)){case 0:return f.heightSmall;case 1:return f.heightBig;default:return f.heightSmall}}function it(){return tt()?3:b()?2:1}function B(){const t=g(a.width/2),e=a.width*2/5+t+f.gapX;return e>a.width*.075?e-a.width/2:e}function et(){const t=.5*a.width,i=3/4*a.width;return j(t,i)}class N{constructor(i,e,n,h,r,d){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.x=i,this.y=e,this.dx=-2,this.dy=m,this.w=v.width,this.h=v.height,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0},this.spriteHeight=r,this.spriteWidth=h,this.totalFrame=d,this.currentFrame=0,this.w=64,this.h=64}draw(i){this.loaded&&l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),i%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}drawVertical(i){this.loaded&&l.drawImage(this.img,0,this.currentFrame*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),i%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}moveInY(){this.y+=this.dy}changeDirection(){this.x<=c.x+c.width||this.x+this.w>=a.width?(this.dx*=-1,this.dx<0?this.img.src="./images/demon-left.png":this.img.src="./images/demon-right.png"):this.dx=this.dx}moveInX(){this.changeDirection(),this.x+=this.dx}}class O extends H{constructor(e,n,h){super(e,n);s(this,"face");this.face=h,this.w=24,this.h=24,this.selectSpike()}selectSpike(){const e=E();this.face==="right"?e?this.img.src="./images/spike1-right.png":this.img.src="./images/spike2-right.png":e?this.img.src="./images/spike1-left.png":this.img.src="./images/spike2-left.png",this.img.onload=()=>{this.loaded=!0}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}moveInY(){this.y+=m}}function F(t){let i;const e=et(),n=A(),h=t?t.y-n-f.gapY:a.height-n-f.gapY,r=it();return r===1?i=new W(e,h,1,"./images/normal-wall.png"):r===2?i=new W(e,h,2,"./images/rubber-wall.png"):i=new W(e,h,3,"./images/ice-wall.png"),i.h=n,i}function st(t){const i=[];for(let e=0;e<t;++e){let n=i.length?F(i[i.length-1]):F(null);i.push(n)}return i}function ht(){const t=B(),i=t+D-2*k.width>a.width-k.width?a.width-k.width:t+D,e=j(t,i);return new $(e,0,"horizontal","./images/saw-blade.png",t,i)}function J(t){const i=a.height/(t+1),e=[];for(let n=0;n<t;++n){const h=ht(),r=a.height-h.h-i*(n+1);h.y=r,h.dx=E()?1:-1,h.dy=E()?1:-1,e.push(h)}return e}function nt(t){return new O(0,0,t)}function rt(){const t=E()?"right":"left";return nt(t)}function R(){const t=V.height*10,i=g(4),e=[];for(let n=0;n<i;++n){let h=0;e.length&&(h=e[e.length-1].y-t);const r=new O(c.width,h,"right");r.w=32,r.h=32,r.x=r.x-c.xOffSet,e.push(r)}return e}function ot(){const t=B();return new N(t,0,"./images/demon-left.png",79,69,4)}function at(){return[]}function dt(){let t="";switch(g(4)){case 0:t="./images/spider-black.png";break;case 1:t="./images/spider-purple.png";break;case 2:t="./images/spider-green.png";break;case 3:t="./images/spider-brown.png";break}const e=c.x+c.width-c.xOffSet*2,n=new N(e,0,t,49,80.3,3);return n.dy=U,n}function ct(){return[]}function lt(t){if(t.length){const i=t[t.length-1];if(t[t.length-1].y>f.gapY){const e=A(),n=t[t.length-1].y-f.gapY-e,h=F(i);h.h=e,h.y=n,t.push(h)}}else t.push(F(null))}function ut(t){if(t.forEach(i=>{i.y>a.height&&t.shift()}),t.length===0){const i=J(g(3));i.reverse(),i.forEach(e=>{e.y*=-1}),t.push(...i)}}function ft(t){if(t.forEach(i=>{i.y>a.height&&t.shift()}),t.length===0){const i=R();t.push(...i)}}function S(t,i){t.length&&(t[0].y>a.height&&t.shift(),t.forEach(e=>{e.moveInY(),i==="demon"&&e.moveInX()}))}const mt=document.querySelector(".start-menu"),X=document.querySelector(".restart-menu");function Y(t){mt.style.display="none",X.style.display="none",y.style.display="block";const i=setTimeout(()=>{t.clickState=!0,clearTimeout(i)},10)}function x(t){X.style.display="flex",y.style.display="none";const i=setTimeout(()=>{t.clickState=!0,clearTimeout(i)},10)}class P{constructor(i,e,n){s(this,"x");s(this,"y");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"duration");this.x=i,this.y=e,this.w=32,this.h=48,this.dy=m,this.loaded=!1,this.img=new Image,this.img.src=n,this.duration=0,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}setDuration(i){this.duration=i}getDuration(){return this.duration}moveInY(){this.y+=this.dy}}function gt(t,i){const e=t.x+t.w/2-(i.x+i.w/2),n=t.y+t.h/2-(i.y+i.h/2),h=(t.w+i.w)/2,r=(t.h+i.h)/2,d=h*n,p=r*e;if(Math.abs(e)<=h&&Math.abs(n)<=r)if(d>p){if(d>-p)t.y=i.y+i.h-t.h/2,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w;else if(t.x=i.x-t.w,t.xDirection=-1,t.img.src="./images/grab-right.png",i.type===3&&!i.effectUsed){const C=new P(t.x,t.y,"./images/icecloud-right.png");i.effect=C}}else if(d>-p){if(t.x=i.x+i.w,t.xDirection=1,t.img.src="./images/grab-left.png",i.type===3&&!i.effectUsed){const C=new P(t.x,t.y,"./images/icecloud-left.png");i.effect=C}}else t.y=i.y,t.x<i.x?t.x=i.x-t.w:t.x=i.x+i.w}function L(t){t.xDirection*=-1,t.dx=t.xDirection*M,t.dy+=w/2,t.isJumping=!0}class pt{constructor(i,e,n){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"horizontalDelay");s(this,"gravity");s(this,"isJumping");s(this,"jumpCount");s(this,"xDirection");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.x=i,this.y=e,this.w=32,this.h=32,this.xDirection=1,this.horizontalDelay=.05,this.gravity=.1,this.dx=M,this.dy=w,this.isJumping=!1,this.jumpCount=2,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0,this.draw()},this.spriteHeight=67,this.spriteWidth=64,this.currentFrame=0,this.totalFrame=8}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}drawJumpSprite(i){this.loaded&&(l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,48,48),i%2===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame))}resetJump(){this.jumpCount===1&&(this.xDirection*=-1),this.dx=M*this.xDirection,this.dy=w}changeJumpingImage(){this.dx>0&&this.jumpCount===1?this.img.src="./images/jump-right.png":this.dx<0&&this.jumpCount===1?this.img.src="./images/jump-left.png":this.dx>0&&this.jumpCount===0?this.img.src="./images/mid-jump-right-sprite.png":this.img.src="./images/mid-jump-left-sprite.png"}jump(){this.changeJumpingImage(),this.dy+=this.gravity,this.dx=this.dx>0?this.dx-this.horizontalDelay:this.dx+this.horizontalDelay,this.x+=this.dx,this.dy>0?this.y+=this.dy:this.y>0?this.y+=this.dy:this.y=0,this.dy>-w&&(this.dy=-w)}isColliding(i){return i.x<this.x+this.w&&i.x+i.w>this.x&&i.y<this.y+this.h/2&&i.y+i.h>this.y}collisionWall(i){this.isColliding(i)&&(this.jumpCount=2,this.isJumping=!1,i.type===2&&(this.isJumping=!0,--this.jumpCount,L(this))),gt(this,i)}moveInY(){this.y+=m,this.x+this.w>a.width&&L(this)}}const yt=document.querySelector(".btn--start"),xt=document.querySelector(".btn--restart"),o={pause:!1,clickState:!1,restart:!1},z=()=>({blades:J(2),mainWall:new W(c.x,c.y,0,"./images/main-platform.png"),walls:st(4),player:new pt(Z,K,"./images/grab-left.png"),gameSpeed:0,demons:at(),spiders:ct(),mainWallSpikes:R()});let u=z();function I(t){l.clearRect(0,0,a.width,a.height),++t.gameSpeed,t.mainWall.draw(),t.gameSpeed%500===0&&b()&&t.demons.push(ot()),S(t.demons,"demon");for(let i=0;i<t.demons.length&&!o.restart;++i){const e=t.demons[i];if(e.draw(t.gameSpeed),t.player.isColliding(e)){o.restart=!0,x(o);return}}t.gameSpeed%300===0&&b()&&t.spiders.push(dt()),S(t.spiders,"spider");for(let i=0;i<t.spiders.length&&!o.restart;++i){const e=t.spiders[i];if(e.drawVertical(t.gameSpeed),t.player.isColliding(e)){o.restart=!0,x(o);return}}for(let i=0;i<t.mainWallSpikes.length&&!o.restart;++i){const e=t.mainWallSpikes[i];if(e.moveInY(),e.draw(),t.player.isColliding(e)){o.restart=!0,x(o);return}}t.player.moveInY(),t.player.collisionWall(t.mainWall),t.player.jumpCount?t.player.draw():t.player.drawJumpSprite(t.gameSpeed),t.player.isJumping&&t.player.jump();for(let i=0;i<t.walls.length&&!o.restart;++i){const e=t.walls[i];if(e.moveInY(),e.draw(),e.effect&&!e.effectUsed){e.effect.draw(),o.clickState=!1;const n=setTimeout(()=>{e.effect=null,e.effectUsed=!0,o.clickState=!0,clearTimeout(n)},2e3)}if(e.spike&&(e.spike.draw(),t.player.isColliding(e.spike))){o.restart=!0,x(o);return}t.player.collisionWall(e)}for(let i=0;i<t.blades.length;++i){const e=t.blades[i];if(e.moveInY(),e.draw(),e.oscillate(),t.player.isColliding(e)){o.restart=!0,x(o);return}}ut(t.blades),lt(t.walls),ft(t.mainWallSpikes),!o.pause&&requestAnimationFrame(()=>I(t))}function wt(){yt.onclick=()=>{o.clickState=!1,Y(o),u.mainWall.setMainWall(),I(u)},xt.onclick=()=>{o.clickState=!1,o.restart=!1,Y(o),u=z(),u.mainWall.setMainWall(),I(u)},document.addEventListener("click",()=>{!o.pause&&o.clickState&&(l.clearRect(0,0,a.width,a.height),u.player.jumpCount>0&&(u.player.isJumping=!0,u.player.resetJump(),--u.player.jumpCount))}),document.addEventListener("keydown",t=>{t.key===" "&&o.pause?(o.pause=!1,I(u)):t.key===" "&&(o.pause=!0)})}wt();
