var U=Object.defineProperty;var Z=(t,e,i)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var s=(t,e,i)=>Z(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();const $=document.querySelector(".game-window"),y=document.querySelector(".canvas"),l=y.getContext("2d"),B=$.getBoundingClientRect();y.height=B.height;y.width=B.width;const w=2,K=w+1,a={width:y.width,height:y.height},u={x:0,y:-64,width:64,height:a.height+100,xOffSet:5},p={width:10,heightSmall:72,heightBig:160,gapX:150,gapY:150},F=8,k=-6,Q={width:24,height:24},W={width:32,height:32},L={width:24,height:24},D=100,tt=0+u.width,et=a.height/2;class g{constructor(e){s(this,"sound");this.sound=new Audio,this.sound.src=e}play(){this.sound.play()}stop(){this.sound.pause()}}class H{constructor(e,i){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"pointValue");s(this,"img");s(this,"loaded");s(this,"collisionSound");this.x=e,this.y=i,this.dx=10,this.dy=10,this.w=64,this.h=64,this.pointValue=1,this.loaded=!1,this.img=new Image,this.collisionSound=new g("./sounds/obstaclecollision.m4a")}moveInY(e){this.y+=e}}class it extends H{constructor(i,n,r,o,d,m){super(i,n);s(this,"startPos");s(this,"endPos");s(this,"direction");this.startPos=d,this.endPos=m,this.direction=r,this.img.src=o,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.y)}oscillate(){this.direction==="horizontal"?(this.x>=this.endPos?this.dx=-Math.abs(this.dx):this.x<=this.startPos&&(this.dx=Math.abs(this.dx)),this.x+=this.dx):(this.y>=this.endPos?this.dy=-Math.abs(this.dy):this.y<=this.startPos&&(this.dy=Math.abs(this.dy)),this.y+=this.dy)}}class st extends it{constructor(i,n,r,o,d,m){super(i,n,r,o,d,m);s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.spriteHeight=166,this.spriteWidth=164.5,this.currentFrame=0,this.totalFrame=5,this.h=W.height,this.w=W.width,this.dx=1,this.pointValue=2}draw(){this.loaded&&l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),this.currentFrame=(this.currentFrame+1)%this.totalFrame}}function f(t){return Math.floor(Math.random()*t)}function J(t,e){return Math.floor(Math.random()*(e-t)+t)}function nt(){const t=f(100);return t<20&&t%2===0}function M(){const t=f(100);return t<100/2&&t%2===0}function E(){return f(100)<50}class I{constructor(e,i,n,r){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"type");s(this,"loaded");s(this,"spike");s(this,"effect");s(this,"effectUsed");s(this,"pointValue");s(this,"sound");this.x=e,this.y=i,this.dx=0,this.dy=w,this.w=p.width,this.h=p.heightSmall,this.pointValue=1,this.type=n,this.loaded=!1,this.spike=this.placeSpike(),this.img=new Image,this.img.src=r,this.img.onload=()=>{this.loaded=!0,this.draw()},this.effect=null,this.effectUsed=!1,this.sound=null}updateImage(e){this.img.src=e}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}setMainWall(){this.w=u.width,this.h=u.height}moveInY(e){this.y+=e,this.spike&&this.spike.moveInY(e)}moveInX(){this.x+=this.dx}placeSpike(){if(M()&&this.type<2){const i=ut();i.face==="left"?i.x=this.x-i.w:i.x=this.x+this.w;let n=this.y+f(this.h-i.h);return i.y=n,i}else return null}}function O(){switch(f(2)){case 0:return p.heightSmall;case 1:return p.heightBig;default:return p.heightSmall}}function rt(){return nt()?3:M()?2:1}function A(){const t=f(a.width/2),i=a.width*2/5+t+p.gapX;return i>a.width*.075?i-a.width/2:i}function ot(){const t=.5*a.width,e=3/4*a.width;return J(t,e)}class V{constructor(e,i,n,r,o,d){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");s(this,"pointValue");s(this,"collisionSound");this.x=e,this.y=i,this.dx=-2,this.dy=w,this.w=L.width,this.h=L.height,this.pointValue=3,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0},this.spriteHeight=o,this.spriteWidth=r,this.totalFrame=d,this.currentFrame=0,this.w=64,this.h=64,this.collisionSound=new g("./sounds/obstaclecollision.m4a")}draw(e){this.loaded&&l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),e%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}moveInY(e){this.y+=e}}class ht extends V{constructor(e,i,n,r,o,d){super(e,i,n,r,o,d)}changeDirection(){this.x<=u.x+u.width||this.x+this.w>=a.width?(this.dx*=-1,this.dx<0?this.img.src="./images/demon-left.png":this.img.src="./images/demon-right.png"):this.dx=this.dx}moveInX(){this.changeDirection(),this.x+=this.dx}}class q extends H{constructor(i,n,r){super(i,n);s(this,"face");this.face=r,this.w=24,this.h=24,this.selectSpike()}selectSpike(){const i=E();this.face==="right"?i?this.img.src="./images/spike1-right.png":this.img.src="./images/spike2-right.png":i?this.img.src="./images/spike1-left.png":this.img.src="./images/spike2-left.png",this.img.onload=()=>{this.loaded=!0}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}moveInY(i){this.y+=i}}class at extends V{constructor(e,i,n,r,o,d){super(e,i,n,r,o,d)}draw(e){this.loaded&&l.drawImage(this.img,0,this.currentFrame*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),e%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}moveInY(e){this.y+=e+1}}function S(t){let e;const i=ot(),n=O(),r=t?t.y-n-p.gapY:a.height-n-p.gapY,o=rt();return o===1?e=new I(i,r,1,"./images/normal-wall.png"):o===2?e=new I(i,r,2,"./images/rubber-wall.png"):e=new I(i,r,3,"./images/ice-wall.png"),e.h=n,e}function dt(t){const e=[];for(let i=0;i<t;++i){let n=e.length?S(e[e.length-1]):S(null);e.push(n)}return e}function ct(){const t=A(),e=t+D-2*W.width>a.width-W.width?a.width-W.width:t+D,i=J(t,e);return new st(i,0,"horizontal","./images/saw-blade.png",t,e)}function R(t){const e=a.height/2,i=[];for(let n=0;n<t;++n){const r=ct(),o=a.height-r.h-e*(n+1);r.y=o,r.dx=E()?1:-1,r.dy=E()?1:-1,i.push(r)}return i}function lt(t){return new q(0,0,t)}function ut(){const t=E()?"right":"left";return lt(t)}function z(){const t=Q.height*10,e=f(3),i=[];for(let n=0;n<e;++n){let r=0;i.length&&(r=i[i.length-1].y-t);const o=new q(u.width,r,"right");o.w=32,o.h=32,o.x=o.x-u.xOffSet,i.push(o)}return i}function pt(){const t=A();return new ht(t,0,"./images/demon-left.png",79,69,4)}function ft(){return[]}function mt(){let t="";switch(f(4)){case 0:t="./images/spider-black.png";break;case 1:t="./images/spider-purple.png";break;case 2:t="./images/spider-green.png";break;case 3:t="./images/spider-brown.png";break}const i=u.x+u.width-u.xOffSet*2,n=new at(i,0,t,49,80.3,3);return n.dy=K,n}function gt(){return[]}function yt(t){l.fillStyle="white",l.font="50px Offside",l.fillText(`${t}`,a.width/2,50)}function wt(t,e){if(t.length){const i=t[t.length-1];if(i.y>a.height&&(e.score+=t[0].pointValue,t.shift()),t[t.length-1].y>p.gapY){const n=O(),r=t[t.length-1].y-p.gapY-n,o=S(i);o.h=n,o.y=r,t.push(o)}}else t.push(S(null))}function xt(t,e){if(t.forEach(i=>{i.y>a.height&&(e.score+=i.pointValue,t.shift())}),t.length===0){const i=R(f(3));i.reverse(),i.forEach(n=>{n.y*=-1}),t.push(...i)}}function kt(t,e){if(t.forEach(i=>{i.y>a.height&&(e.score+=i.pointValue,t.shift())}),t.length===0){const i=z();t.push(...i)}}function bt(t,e,i){t.length&&(t[0].y>a.height&&(e.score+=t[0].pointValue,t.shift()),t.forEach(n=>{n.moveInY(i),n.moveInX()}))}function Wt(t,e,i){t.length&&(t[0].y>a.height&&(e.score+=t[0].pointValue,t.shift()),t.forEach(n=>{n.moveInY(i)}))}function It(){let t;const e=localStorage.getItem("walljumper");return e?t=JSON.parse(e):t=[],t}function vt(t){localStorage.setItem("walljumper",JSON.stringify(t))}function Mt(t,e){let i=!1;e.forEach(n=>{n.name===t.name&&(n.value<t.value&&(n.value=t.value),i=!0)}),i||e.push(t)}const Et=document.querySelector(".start-menu"),X=document.querySelector(".restart-menu"),G=document.querySelector(".pause-window"),St=document.querySelector(".score"),N=document.querySelector(".leaderboard");function Ct(t){N.innerHTML="";for(const e of t){const i=document.createElement("p"),n=document.createElement("span"),r=document.createElement("span");i.classList.add("leaderboard-row"),n.classList.add("leaderboard-entry"),r.classList.add("leaderboard-entry"),n.innerHTML=e.name,r.innerHTML=e.value.toString(),i.appendChild(n),i.appendChild(r),N.appendChild(i)}}function Y(t){Et.style.display="none",X.style.display="none",y.style.display="block";const e=setTimeout(()=>{t.clickState=!0,clearTimeout(e)},10)}function x(t,e){e.player.jumpCount=0;const i=It(),n={name:e.userName,value:e.score};Mt(n,i),i.sort((o,d)=>d.value-o.value),vt(i),Ct(i),X.style.display="flex",St.innerHTML=`${e.userName} : ${e.score}`,y.style.display="none";const r=setTimeout(()=>{t.clickState=!0,clearTimeout(r)},10)}function Ft(){G.style.display="flex"}function Lt(){G.style.display="none"}class j{constructor(e,i,n){s(this,"x");s(this,"y");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"duration");this.x=e,this.y=i,this.w=32,this.h=48,this.dy=w,this.loaded=!1,this.img=new Image,this.img.src=n,this.duration=0,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}setDuration(e){this.duration=e}getDuration(){return this.duration}moveInY(){this.y+=this.dy}}function Dt(t,e){const i=t.x+t.w/2-(e.x+e.w/2),n=t.y+t.h/2-(e.y+e.h/2),r=(t.w+e.w)/2,o=(t.h+e.h)/2,d=r*n,m=o*i;if(Math.abs(i)<=r&&Math.abs(n)<=o)if(d>m){if(d>-m)t.y=e.y+e.h-t.h/2,t.x<e.x?t.x=e.x-t.w:t.x=e.x+e.w;else if(t.x=e.x-t.w,t.xDirection=-1,t.img.src="./images/grab-right.png",e.type===3&&!e.effectUsed){const C=new j(t.x,t.y,"./images/icecloud-right.png");e.effect=C}}else if(d>-m){if(t.x=e.x+e.w,t.xDirection=1,t.img.src="./images/grab-left.png",e.type===3&&!e.effectUsed){const C=new j(t.x,t.y,"./images/icecloud-left.png");e.effect=C}}else t.y=e.y,t.x<e.x?t.x=e.x-t.w:t.x=e.x+e.w}function P(t){t.xDirection*=-1,t.dx=t.xDirection*F,t.dy=k,t.isJumping=!0}class Nt{constructor(e,i,n){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"horizontalDelay");s(this,"gravity");s(this,"isJumping");s(this,"jumpCount");s(this,"xDirection");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");s(this,"jumpSound");s(this,"airJumpSound");s(this,"fallSound");this.x=e,this.y=i,this.w=32,this.h=32,this.xDirection=1,this.horizontalDelay=.05,this.gravity=.1,this.dx=F,this.dy=k,this.isJumping=!1,this.jumpCount=2,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0,this.draw()},this.spriteHeight=67,this.spriteWidth=64,this.currentFrame=0,this.totalFrame=8,this.jumpSound=new g("./sounds/jumpsound.m4a"),this.airJumpSound=new g("./sounds/airjumpsound.m4a"),this.fallSound=new g("./sounds/fallsound.m4a")}draw(){this.loaded&&l.drawImage(this.img,this.x,this.y,this.w,this.h)}drawJumpSprite(e){this.loaded&&(l.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,48,48),e%2===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame))}resetJump(){this.jumpCount===1&&(this.xDirection*=-1),this.dx=F*this.xDirection,this.dy=k}changeJumpingImage(){this.dx>0&&this.jumpCount===1?this.img.src="./images/jump-right.png":this.dx<0&&this.jumpCount===1?this.img.src="./images/jump-left.png":this.dx>0&&this.jumpCount===0?this.img.src="./images/mid-jump-right-sprite.png":this.img.src="./images/mid-jump-left-sprite.png"}jump(){this.changeJumpingImage(),this.dy+=this.gravity,this.dx=this.dx>0?this.dx-this.horizontalDelay:this.dx+this.horizontalDelay,this.x+=this.dx,this.dy>0?this.y+=this.dy:this.y>0?this.y+=this.dy:this.y=0,this.dy>-k&&(this.dy=-k)}isColliding(e){return e.x<this.x+this.w&&e.x+e.w>this.x&&e.y<this.y+this.h/2&&e.y+e.h>this.y}collisionWall(e){this.isColliding(e)&&(this.jumpCount=2,this.isJumping=!1,e.type===2?(e.sound=new g("./sounds/rubberbounce1.mp3"),e.sound.play(),this.isJumping=!0,--this.jumpCount,P(this)):e.type===3&&(e.sound=new g("./sounds/freezingSound.m4a"),e.sound.play())),Dt(this,e)}moveInY(e){this.y+=e,this.x+this.w>a.width&&P(this)}}const Yt=document.querySelector(".btn--start"),jt=document.querySelector(".btn--restart"),T=document.querySelector(".user-name");let b;T.onchange=()=>{b=T.value};const h={pause:!1,clickState:!1,restart:!1,gameMovement:w},_=()=>({blades:R(2),mainWall:new I(u.x,u.y,0,"./images/main-platform.png"),walls:dt(3),player:new Nt(tt,et,"./images/grab-left.png"),gameSpeed:0,demons:ft(),spiders:gt(),mainWallSpikes:z(),score:0,userName:"Unknown"});let c=_();function v(t){l.clearRect(0,0,a.width,a.height),yt(t.score),++t.gameSpeed,h.gameMovement=w+t.score/10*.5,t.mainWall.draw(),t.gameSpeed%500===0&&M()&&t.demons.push(pt()),bt(t.demons,t,h.gameMovement);for(let e=0;e<t.demons.length&&!h.restart;++e){const i=t.demons[e];if(i.draw(t.gameSpeed),t.player.isColliding(i)){h.restart=!0,i.collisionSound.play(),x(h,t);return}}t.gameSpeed%300===0&&M()&&t.spiders.push(mt()),Wt(t.spiders,t,h.gameMovement);for(let e=0;e<t.spiders.length&&!h.restart;++e){const i=t.spiders[e];if(i.draw(t.gameSpeed),t.player.isColliding(i)){h.restart=!0,i.collisionSound.play(),x(h,t);return}}for(let e=0;e<t.mainWallSpikes.length&&!h.restart;++e){const i=t.mainWallSpikes[e];if(i.moveInY(h.gameMovement),i.draw(),t.player.isColliding(i)){h.restart=!0,i.collisionSound.play(),x(h,t);return}}if(t.player.moveInY(h.gameMovement),t.player.y>a.height){h.restart=!0,t.player.fallSound.play(),x(h,t);return}t.player.collisionWall(t.mainWall),t.player.jumpCount?t.player.draw():t.player.drawJumpSprite(t.gameSpeed),t.player.isJumping&&t.player.jump();for(let e=0;e<t.walls.length&&!h.restart;++e){const i=t.walls[e];if(i.moveInY(h.gameMovement),i.draw(),i.effect&&!i.effectUsed){i.effect.draw(),h.clickState=!1;const n=setTimeout(()=>{i.effect=null,i.effectUsed=!0,h.clickState=!0,clearTimeout(n)},2e3)}if(i.spike&&(i.spike.draw(),t.player.isColliding(i.spike))){h.restart=!0,i.spike.collisionSound.play(),x(h,t);return}t.player.collisionWall(i)}for(let e=0;e<t.blades.length;++e){const i=t.blades[e];if(i.moveInY(h.gameMovement),i.draw(),i.oscillate(),t.player.isColliding(i)){h.restart=!0,i.collisionSound.play(),x(h,t);return}}xt(t.blades,t),wt(t.walls,t),kt(t.mainWallSpikes,t),!h.pause&&requestAnimationFrame(()=>v(t))}function Pt(){Yt.onclick=()=>{b&&(c.userName=b),h.clickState=!1,Y(h),c.mainWall.setMainWall(),v(c)},jt.onclick=()=>{h.clickState=!1,h.restart=!1,h.gameMovement=w,Y(h),c=_(),b&&(c.userName=b),c.mainWall.setMainWall(),v(c)},document.addEventListener("click",()=>{!h.pause&&h.clickState&&(l.clearRect(0,0,a.width,a.height),c.player.jumpCount>0&&(c.player.isJumping=!0,c.player.jumpCount===2?c.player.jumpSound.play():c.player.airJumpSound.play(),c.player.resetJump(),--c.player.jumpCount))}),document.addEventListener("keydown",t=>{t.key===" "&&h.pause?(h.pause=!1,Lt(),v(c)):t.key===" "&&!h.restart&&(h.pause=!0,Ft())})}Pt();
