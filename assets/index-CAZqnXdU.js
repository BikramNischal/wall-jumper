var Z=Object.defineProperty;var $=(t,e,i)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var s=(t,e,i)=>$(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(r){if(r.ep)return;r.ep=!0;const h=i(r);fetch(r.href,h)}})();const K=document.querySelector(".game-window"),y=document.querySelector(".canvas"),c=y.getContext("2d"),H=K.getBoundingClientRect();y.height=H.height;y.width=H.width;const w=2,Q=w+1,a={width:y.width,height:y.height},u={x:0,y:-64,width:64,height:a.height+100,xOffSet:5},p={width:10,heightSmall:72,heightBig:160,gapX:150,gapY:150},F=8,k=-6,tt={width:24,height:24},W={width:32,height:32},L={width:24,height:24},N=100,et=0+u.width,it=a.height/2;class g{constructor(e){s(this,"sound");this.sound=new Audio,this.sound.src=e}play(){this.sound.play()}stop(){this.sound.pause()}}class J{constructor(e,i){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"pointValue");s(this,"img");s(this,"loaded");s(this,"collisionSound");this.x=e,this.y=i,this.dx=10,this.dy=10,this.w=64,this.h=64,this.pointValue=1,this.loaded=!1,this.img=new Image,this.collisionSound=new g("./sounds/obstaclecollision.m4a")}moveInY(e){this.y+=e}}class st extends J{constructor(i,n,r,h,d,f){super(i,n);s(this,"startPos");s(this,"endPos");s(this,"direction");this.startPos=d,this.endPos=f,this.direction=r,this.img.src=h,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&c.drawImage(this.img,this.x,this.y,this.w,this.y)}oscillate(){this.direction==="horizontal"?(this.x>=this.endPos?this.dx=-Math.abs(this.dx):this.x<=this.startPos&&(this.dx=Math.abs(this.dx)),this.x+=this.dx):(this.y>=this.endPos?this.dy=-Math.abs(this.dy):this.y<=this.startPos&&(this.dy=Math.abs(this.dy)),this.y+=this.dy)}}class nt extends st{constructor(i,n,r,h,d,f){super(i,n,r,h,d,f);s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");this.spriteHeight=166,this.spriteWidth=164.5,this.currentFrame=0,this.totalFrame=5,this.h=W.height,this.w=W.width,this.dx=1,this.pointValue=2}draw(){this.loaded&&c.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),this.currentFrame=(this.currentFrame+1)%this.totalFrame}}function m(t){return Math.floor(Math.random()*t)}function O(t,e){return Math.floor(Math.random()*(e-t)+t)}function rt(){const t=m(100);return t<20&&t%2===0}function M(){const t=m(100);return t<100/2&&t%2===0}function E(){return m(100)<50}class I{constructor(e,i,n,r){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"type");s(this,"loaded");s(this,"spike");s(this,"effect");s(this,"effectUsed");s(this,"pointValue");s(this,"sound");this.x=e,this.y=i,this.dx=0,this.dy=w,this.w=p.width,this.h=p.heightSmall,this.pointValue=1,this.type=n,this.loaded=!1,this.spike=this.placeSpike(),this.img=new Image,this.img.src=r,this.img.onload=()=>{this.loaded=!0,this.draw()},this.effect=null,this.effectUsed=!1,this.sound=null}updateImage(e){this.img.src=e}draw(){this.loaded&&c.drawImage(this.img,this.x,this.y,this.w,this.h)}setMainWall(){this.w=u.width,this.h=u.height}moveInY(e){this.y+=e,this.spike&&this.spike.moveInY(e)}moveInX(){this.x+=this.dx}placeSpike(){if(M()&&this.type<2){const i=ct();i.face==="left"?i.x=this.x-i.w:i.x=this.x+this.w;let n=this.y+m(this.h-i.h);return i.y=n,i}else return null}}function V(){switch(m(2)){case 0:return p.heightSmall;case 1:return p.heightBig;default:return p.heightSmall}}function ot(){return rt()?3:M()?2:1}function A(){const t=m(a.width/2),i=a.width*2/5+t+p.gapX;return i>a.width*.075?i-a.width/2:i}function ht(){const t=.5*a.width,e=3/4*a.width;return O(t,e)}class q{constructor(e,i,n,r,h,d){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");s(this,"pointValue");s(this,"collisionSound");this.x=e,this.y=i,this.dx=-2,this.dy=w,this.w=L.width,this.h=L.height,this.pointValue=3,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0},this.spriteHeight=h,this.spriteWidth=r,this.totalFrame=d,this.currentFrame=0,this.w=64,this.h=64,this.collisionSound=new g("./sounds/obstaclecollision.m4a")}draw(e){this.loaded&&c.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),e%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}drawVertical(e){this.loaded&&c.drawImage(this.img,0,this.currentFrame*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x,this.y,this.w,this.h),e%10===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame)}moveInY(e){this.y+=e}changeDirection(){this.x<=u.x+u.width||this.x+this.w>=a.width?(this.dx*=-1,this.dx<0?this.img.src="./images/demon-left.png":this.img.src="./images/demon-right.png"):this.dx=this.dx}moveInX(){this.changeDirection(),this.x+=this.dx}}class R extends J{constructor(i,n,r){super(i,n);s(this,"face");this.face=r,this.w=24,this.h=24,this.selectSpike()}selectSpike(){const i=E();this.face==="right"?i?this.img.src="./images/spike1-right.png":this.img.src="./images/spike2-right.png":i?this.img.src="./images/spike1-left.png":this.img.src="./images/spike2-left.png",this.img.onload=()=>{this.loaded=!0}}draw(){this.loaded&&c.drawImage(this.img,this.x,this.y,this.w,this.h)}moveInY(i){this.y+=i}}function S(t){let e;const i=ht(),n=V(),r=t?t.y-n-p.gapY:a.height-n-p.gapY,h=ot();return h===1?e=new I(i,r,1,"./images/normal-wall.png"):h===2?e=new I(i,r,2,"./images/rubber-wall.png"):e=new I(i,r,3,"./images/ice-wall.png"),e.h=n,e}function at(t){const e=[];for(let i=0;i<t;++i){let n=e.length?S(e[e.length-1]):S(null);e.push(n)}return e}function dt(){const t=A(),e=t+N-2*W.width>a.width-W.width?a.width-W.width:t+N,i=O(t,e);return new nt(i,0,"horizontal","./images/saw-blade.png",t,e)}function z(t){const e=a.height/2,i=[];for(let n=0;n<t;++n){const r=dt(),h=a.height-r.h-e*(n+1);r.y=h,r.dx=E()?1:-1,r.dy=E()?1:-1,i.push(r)}return i}function lt(t){return new R(0,0,t)}function ct(){const t=E()?"right":"left";return lt(t)}function X(){const t=tt.height*10,e=m(3),i=[];for(let n=0;n<e;++n){let r=0;i.length&&(r=i[i.length-1].y-t);const h=new R(u.width,r,"right");h.w=32,h.h=32,h.x=h.x-u.xOffSet,i.push(h)}return i}function ut(){const t=A();return new q(t,0,"./images/demon-left.png",79,69,4)}function pt(){return[]}function mt(){let t="";switch(m(4)){case 0:t="./images/spider-black.png";break;case 1:t="./images/spider-purple.png";break;case 2:t="./images/spider-green.png";break;case 3:t="./images/spider-brown.png";break}const i=u.x+u.width-u.xOffSet*2,n=new q(i,0,t,49,80.3,3);return n.dy=Q,n}function ft(){return[]}function gt(t){c.fillStyle="white",c.font="50px Offside",c.fillText(`${t}`,a.width/2,50)}function yt(t,e){if(t.length){const i=t[t.length-1];if(i.y>a.height&&(e.score+=t[0].pointValue,t.shift()),t[t.length-1].y>p.gapY){const n=V(),r=t[t.length-1].y-p.gapY-n,h=S(i);h.h=n,h.y=r,t.push(h)}}else t.push(S(null))}function wt(t,e){if(t.forEach(i=>{i.y>a.height&&(e.score+=i.pointValue,t.shift())}),t.length===0){const i=z(m(3));i.reverse(),i.forEach(n=>{n.y*=-1}),t.push(...i)}}function xt(t,e){if(t.forEach(i=>{i.y>a.height&&(e.score+=i.pointValue,t.shift())}),t.length===0){const i=X();t.push(...i)}}function j(t,e,i,n){t.length&&(t[0].y>a.height&&(i.score+=t[0].pointValue,t.shift()),t.forEach(r=>{r.moveInY(n),e==="demon"&&r.moveInX()}))}function kt(){let t;const e=localStorage.getItem("walljumper");return e?t=JSON.parse(e):t=[],t}function bt(t){localStorage.setItem("walljumper",JSON.stringify(t))}function Wt(t,e){let i=!1;e.forEach(n=>{n.name===t.name&&(n.value<t.value&&(n.value=t.value),i=!0)}),i||e.push(t)}const It=document.querySelector(".start-menu"),G=document.querySelector(".restart-menu"),_=document.querySelector(".pause-window"),vt=document.querySelector(".score"),D=document.querySelector(".leaderboard");function Mt(t){D.innerHTML="";for(const e of t){const i=document.createElement("p"),n=document.createElement("span"),r=document.createElement("span");i.classList.add("leaderboard-row"),n.classList.add("leaderboard-entry"),r.classList.add("leaderboard-entry"),n.innerHTML=e.name,r.innerHTML=e.value.toString(),i.appendChild(n),i.appendChild(r),D.appendChild(i)}}function P(t){It.style.display="none",G.style.display="none",y.style.display="block";const e=setTimeout(()=>{t.clickState=!0,clearTimeout(e)},10)}function x(t,e){e.player.jumpCount=0;const i=kt(),n={name:e.userName,value:e.score};Wt(n,i),i.sort((h,d)=>d.value-h.value),bt(i),Mt(i),G.style.display="flex",vt.innerHTML=`${e.userName} : ${e.score}`,y.style.display="none";const r=setTimeout(()=>{t.clickState=!0,clearTimeout(r)},10)}function Et(){_.style.display="flex"}function St(){_.style.display="none"}class Y{constructor(e,i,n){s(this,"x");s(this,"y");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"duration");this.x=e,this.y=i,this.w=32,this.h=48,this.dy=w,this.loaded=!1,this.img=new Image,this.img.src=n,this.duration=0,this.img.onload=()=>{this.loaded=!0,this.draw()}}draw(){this.loaded&&c.drawImage(this.img,this.x,this.y,this.w,this.h)}setDuration(e){this.duration=e}getDuration(){return this.duration}moveInY(){this.y+=this.dy}}function Ct(t,e){const i=t.x+t.w/2-(e.x+e.w/2),n=t.y+t.h/2-(e.y+e.h/2),r=(t.w+e.w)/2,h=(t.h+e.h)/2,d=r*n,f=h*i;if(Math.abs(i)<=r&&Math.abs(n)<=h)if(d>f){if(d>-f)t.y=e.y+e.h-t.h/2,t.x<e.x?t.x=e.x-t.w:t.x=e.x+e.w;else if(t.x=e.x-t.w,t.xDirection=-1,t.img.src="./images/grab-right.png",e.type===3&&!e.effectUsed){const C=new Y(t.x,t.y,"./images/icecloud-right.png");e.effect=C}}else if(d>-f){if(t.x=e.x+e.w,t.xDirection=1,t.img.src="./images/grab-left.png",e.type===3&&!e.effectUsed){const C=new Y(t.x,t.y,"./images/icecloud-left.png");e.effect=C}}else t.y=e.y,t.x<e.x?t.x=e.x-t.w:t.x=e.x+e.w}function T(t){t.xDirection*=-1,t.dx=t.xDirection*F,t.dy+=k/2,t.isJumping=!0}class Ft{constructor(e,i,n){s(this,"x");s(this,"y");s(this,"dx");s(this,"dy");s(this,"w");s(this,"h");s(this,"img");s(this,"loaded");s(this,"horizontalDelay");s(this,"gravity");s(this,"isJumping");s(this,"jumpCount");s(this,"xDirection");s(this,"spriteWidth");s(this,"spriteHeight");s(this,"currentFrame");s(this,"totalFrame");s(this,"jumpSound");s(this,"airJumpSound");s(this,"fallSound");this.x=e,this.y=i,this.w=32,this.h=32,this.xDirection=1,this.horizontalDelay=.05,this.gravity=.1,this.dx=F,this.dy=k,this.isJumping=!1,this.jumpCount=2,this.loaded=!1,this.img=new Image,this.img.src=n,this.img.onload=()=>{this.loaded=!0,this.draw()},this.spriteHeight=67,this.spriteWidth=64,this.currentFrame=0,this.totalFrame=8,this.jumpSound=new g("./sounds/jumpsound.m4a"),this.airJumpSound=new g("./sounds/airjumpsound.m4a"),this.fallSound=new g("./sounds/fallsound.m4a")}draw(){this.loaded&&c.drawImage(this.img,this.x,this.y,this.w,this.h)}drawJumpSprite(e){this.loaded&&(c.drawImage(this.img,this.currentFrame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,48,48),e%2===0&&(this.currentFrame=(this.currentFrame+1)%this.totalFrame))}resetJump(){this.jumpCount===1&&(this.xDirection*=-1),this.dx=F*this.xDirection,this.dy=k}changeJumpingImage(){this.dx>0&&this.jumpCount===1?this.img.src="./images/jump-right.png":this.dx<0&&this.jumpCount===1?this.img.src="./images/jump-left.png":this.dx>0&&this.jumpCount===0?this.img.src="./images/mid-jump-right-sprite.png":this.img.src="./images/mid-jump-left-sprite.png"}jump(){this.changeJumpingImage(),this.dy+=this.gravity,this.dx=this.dx>0?this.dx-this.horizontalDelay:this.dx+this.horizontalDelay,this.x+=this.dx,this.dy>0?this.y+=this.dy:this.y>0?this.y+=this.dy:this.y=0,this.dy>-k&&(this.dy=-k)}isColliding(e){return e.x<this.x+this.w&&e.x+e.w>this.x&&e.y<this.y+this.h/2&&e.y+e.h>this.y}collisionWall(e){this.isColliding(e)&&(this.jumpCount=2,this.isJumping=!1,e.type===2?(e.sound=new g("./sounds/rubberbounce1.mp3"),e.sound.play(),this.isJumping=!0,--this.jumpCount,T(this)):e.type===3&&(e.sound=new g("./sounds/freezingSound.m4a"),e.sound.play())),Ct(this,e)}moveInY(e){this.y+=e,this.x+this.w>a.width&&T(this)}}const Lt=document.querySelector(".btn--start"),Nt=document.querySelector(".btn--restart"),B=document.querySelector(".user-name");let b;B.onchange=()=>{b=B.value};const o={pause:!1,clickState:!1,restart:!1,gameMovement:w},U=()=>({blades:z(2),mainWall:new I(u.x,u.y,0,"./images/main-platform.png"),walls:at(3),player:new Ft(et,it,"./images/grab-left.png"),gameSpeed:0,demons:pt(),spiders:ft(),mainWallSpikes:X(),score:0,userName:"Unknown"});let l=U();function v(t){c.clearRect(0,0,a.width,a.height),gt(t.score),++t.gameSpeed,o.gameMovement=w+t.score/10*.5,t.mainWall.draw(),t.gameSpeed%500===0&&M()&&t.demons.push(ut()),j(t.demons,"demon",t,o.gameMovement);for(let e=0;e<t.demons.length&&!o.restart;++e){const i=t.demons[e];if(i.draw(t.gameSpeed),t.player.isColliding(i)){o.restart=!0,i.collisionSound.play(),x(o,t);return}}t.gameSpeed%300===0&&M()&&t.spiders.push(mt()),j(t.spiders,"spider",t,o.gameMovement);for(let e=0;e<t.spiders.length&&!o.restart;++e){const i=t.spiders[e];if(i.drawVertical(t.gameSpeed),t.player.isColliding(i)){o.restart=!0,i.collisionSound.play(),x(o,t);return}}for(let e=0;e<t.mainWallSpikes.length&&!o.restart;++e){const i=t.mainWallSpikes[e];if(i.moveInY(o.gameMovement),i.draw(),t.player.isColliding(i)){o.restart=!0,i.collisionSound.play(),x(o,t);return}}if(t.player.moveInY(o.gameMovement),t.player.y>a.height){o.restart=!0,t.player.fallSound.play(),x(o,t);return}t.player.collisionWall(t.mainWall),t.player.jumpCount?t.player.draw():t.player.drawJumpSprite(t.gameSpeed),t.player.isJumping&&t.player.jump();for(let e=0;e<t.walls.length&&!o.restart;++e){const i=t.walls[e];if(i.moveInY(o.gameMovement),i.draw(),i.effect&&!i.effectUsed){i.effect.draw(),o.clickState=!1;const n=setTimeout(()=>{i.effect=null,i.effectUsed=!0,o.clickState=!0,clearTimeout(n)},2e3)}if(i.spike&&(i.spike.draw(),t.player.isColliding(i.spike))){o.restart=!0,i.spike.collisionSound.play(),x(o,t);return}t.player.collisionWall(i)}for(let e=0;e<t.blades.length;++e){const i=t.blades[e];if(i.moveInY(o.gameMovement),i.draw(),i.oscillate(),t.player.isColliding(i)){o.restart=!0,i.collisionSound.play(),x(o,t);return}}wt(t.blades,t),yt(t.walls,t),xt(t.mainWallSpikes,t),!o.pause&&requestAnimationFrame(()=>v(t))}function jt(){Lt.onclick=()=>{b&&(l.userName=b),o.clickState=!1,P(o),l.mainWall.setMainWall(),v(l)},Nt.onclick=()=>{o.clickState=!1,o.restart=!1,o.gameMovement=w,P(o),l=U(),b&&(l.userName=b),l.mainWall.setMainWall(),v(l)},document.addEventListener("click",()=>{!o.pause&&o.clickState&&(c.clearRect(0,0,a.width,a.height),l.player.jumpCount>0&&(l.player.isJumping=!0,l.player.jumpCount===2?l.player.jumpSound.play():l.player.airJumpSound.play(),l.player.resetJump(),--l.player.jumpCount))}),document.addEventListener("keydown",t=>{t.key===" "&&o.pause?(o.pause=!1,St(),v(l)):t.key===" "&&!o.restart&&(o.pause=!0,Et())})}jt();
